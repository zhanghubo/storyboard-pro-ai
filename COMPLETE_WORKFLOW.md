# 🎬 Storyboard Grid Pro - 完整工作流程

## 📋 系统概述

本系统现已支持完整的AI驱动视频制作流程：
1. **文本生成** - 大语言模型生成分镜描述
2. **图像生成** - 文生图模型为每个分镜生成图片
3. **视频合成** - 视频模型将图片合成为视频

## 🔧 已实现的功能

### ✅ 核心模块

1. **`lib/aiService.ts`** - 大语言模型API集成
   - 支持：OpenAI、DeepSeek、Claude、火山引擎豆包、通义千问、智谱AI
   - 功能：生成分镜场景描述和提示词

2. **`lib/imageService.ts`** - 图像生成API集成
   - 支持：火山引擎豆包图像、DALL-E 3
   - 功能：批量生成分镜图片，带进度回调

3. **`lib/videoService.ts`** - 视频生成API集成
   - 支持：火山引擎豆包视频
   - 功能：将图片合成视频，支持转场效果

4. **`components/AdvancedConfigPanel.tsx`** - 高级配置面板
   - 一站式配置所有API
   - 可选择性启用图像和视频生成
   - 实时连接测试

## 🔗 火山引擎豆包配置指南

### 1. 访问火山引擎控制台
URL: https://console.volcengine.com/ark

### 2. 创建推理接入点

#### 大语言模型（必需）
1. 选择模型：Doubao-pro-4k 或 Doubao-lite-4k
2. 创建推理接入点
3. 获取 **Endpoint ID**（格式：`ep-20241218xxxxx-xxxxx`）
4. 复制 **API Key**

#### 文生图模型（可选）
1. 进入"图像生成"模块
2. 选择文生图模型
3. 创建推理接入点
4. 获取图像生成的 **Endpoint ID**
5. 可使用相同的 API Key 或创建新的

#### 视频生成模型（可选）
1. 进入"视频生成"模块
2. 选择视频合成模型
3. 创建推理接入点
4. 获取视频生成的 **Endpoint ID**
5. 可使用相同的 API Key

### 3. API格式说明

所有火山引擎API使用OpenAI兼容格式：

**基础URL：** `https://ark.cn-beijing.volces.com/api/v3`

**文本生成：**
```
POST /chat/completions
```

**图像生成：**
```
POST /image/generations
```

**视频生成：**
```
POST /video/generations
GET /video/generations/{task_id}  # 查询状态
```

## 🎯 完整使用流程

### 步骤1：配置API

在初始配置页面填写：

```
1️⃣ 文本生成API（必需）
   - 服务商：火山引擎豆包
   - Endpoint ID：ep-xxxxx-xxxxx
   - API密钥：your-api-key

2️⃣ 图像生成API（可选，勾选"启用图像生成"）
   - 服务商：火山引擎豆包-图像
   - Endpoint ID：ep-xxxxx-xxxxx（图像模型的ID）
   - API密钥：your-api-key

3️⃣ 视频生成API（可选，勾选"启用视频合成"）
   - 服务商：火山引擎豆包-视频
   - Endpoint ID：ep-xxxxx-xxxxx（视频模型的ID）
   - API密钥：your-api-key
```

### 步骤2：选择分镜数量
- 9个（3x3）- 快速叙事
- 15个（3x5）- 标准叙事
- 20个（4x5）- 史诗叙事

### 步骤3：配置输出
- **输出模式**：单图模式 或 拼图模式
- **画面比例**：16:9横版 或 9:16竖版

### 步骤4：输入故事
- 详细描述故事情节
- 选择视觉风格（电影感、动画等）

### 步骤5：自动生成

系统将依次执行：

```
1. 生成分镜描述 ✓
   ↓
2. 生成AI绘画提示词 ✓
   ↓
3. 【如果启用】生成分镜图片 ✓
   - 显示进度：1/15, 2/15, ...
   - 预计时间：每张2-30秒
   ↓
4. 【如果启用】合成视频 ✓
   - 添加转场效果
   - 合成最终视频
   - 生成下载链接
```

### 步骤6：导出结果

可以导出：
- **提示词**：MD/DOC/HTML/JSON/TXT格式
- **图片**：单张或合成大图
- **视频**：MP4格式

## 💰 费用估算

### 火山引擎豆包（参考）

| 服务 | 模型 | 计费方式 | 参考价格 |
|------|------|----------|---------|
| 文本生成 | Doubao-pro-4k | 按Token | ¥0.008/1K tokens |
| 文本生成 | Doubao-lite-4k | 按Token | ¥0.0003/1K tokens |
| 图像生成 | 文生图模型 | 按次 | ¥0.08/张 |
| 视频生成 | 视频模型 | 按秒 | ¥0.5/秒 |

### 成本示例（15个分镜）

**仅生成提示词：**
- 文本Token：约5000 tokens
- 费用：¥0.04-0.05

**生成提示词 + 图片：**
- 文本：¥0.04
- 图片：15张 × ¥0.08 = ¥1.20
- 总计：¥1.24

**完整流程（含视频）：**
- 文本：¥0.04
- 图片：¥1.20
- 视频：45秒 × ¥0.5 = ¥22.50
- 总计：¥23.74

## 🎨 输出示例

### 单图模式 + 图像生成
```
分镜1.jpg (1920x1080, 16:9)
分镜2.jpg (1920x1080, 16:9)
...
分镜15.jpg (1920x1080, 16:9)
```

### 拼图模式 + 图像生成
```
完整分镜板.jpg (1920x1080, 包含15个小格)
```

### 完整视频输出
```
故事板视频.mp4 (1920x1080, 45秒, 30fps)
- 15个分镜画面
- 自动转场效果
- 配置的背景音乐（可选）
```

## ⚙️ 高级配置

### 图像生成参数
```typescript
{
  quality: "high" | "standard",  // 图像质量
  size: "1920x1080" | "1080x1920",  // 尺寸
  style: "vivid" | "natural"  // 风格
}
```

### 视频合成参数
```typescript
{
  fps: 30,  // 帧率
  transitions: ["fade", "dissolve", "wipe"],  // 转场效果
  audioUrl: "https://...",  // 背景音乐
  duration: [3, 4, 3, ...],  // 每个分镜时长
}
```

## 🚨 注意事项

1. **API密钥安全**
   - 仅在本地使用，不会上传
   - 建议使用环境变量存储

2. **生成时间**
   - 文本生成：5-10秒
   - 单张图片：2-30秒
   - 视频合成：1-5分钟

3. **费用控制**
   - 建议先用少量分镜测试
   - 可选择性启用图像/视频
   - 设置API用量预警

4. **质量优化**
   - 提供详细的故事描述
   - 选择合适的视觉风格
   - 调整每个分镜的时长

## 📞 技术支持

### 常见问题

**Q: Endpoint ID在哪里获取？**
A: 在火山引擎控制台创建推理接入点后自动生成。

**Q: 可以使用不同服务商的API组合吗？**
A: 可以！文本用OpenAI，图像用火山引擎都可以。

**Q: 图像生成失败怎么办？**
A: 检查Endpoint ID、API密钥、网络连接。

**Q: 视频合成需要多久？**
A: 通常1-5分钟，取决于分镜数量和长度。

## 🔗 相关链接

- **火山引擎控制台**: https://console.volcengine.com/ark
- **API文档**: https://www.volcengine.com/docs/82379/1099455
- **计费说明**: https://www.volcengine.com/docs/pricing

---

*最后更新：2024-12-24*
*版本：2.0 - 完整AI工作流*


# 🎬 完整工作流程说明

## 📋 三步完整流程

您的故事板生成器支持**完整的AI驱动工作流程**，从文字到视频，一站式完成！

---

## 🔄 工作流程图

```
📝 故事描述
    ↓
🤖 文本大模型 → 生成分镜提示词
    ↓
🎨 文生图模型 → 生成每个分镜的图片
    ↓
🎬 图生视频模型 → 合成最终视频
    ↓
✅ 完整作品
```

---

## 🎯 步骤详解

### 第一步：配置三个API

#### 1️⃣ 文本生成API（必需）⭐
**作用**：根据故事描述生成详细的分镜脚本

**支持的服务商**：
- ✅ OpenAI（GPT-4, GPT-3.5）
- ✅ Anthropic（Claude）
- ✅ 智谱AI（GLM）
- ✅ 通义千问（Qwen）
- ✅ 豆包大模型（Doubao）
- ✅ DeepSeek

**配置内容**：
- API密钥
- 模型名称（或 Endpoint ID）

---

#### 2️⃣ 图像生成API（可选，默认启用）🎨
**作用**：为每个分镜提示词生成对应的图片

**支持的服务商**：
- ✅ 豆包文生图（Doubao Image）
- ✅ DALL-E 3（OpenAI）

**配置内容**：
- API密钥
- Endpoint ID 或模型名称

**说明**：
- ✅ **默认已启用**，勾选复选框即可
- ⚠️ 如果**不配置**，系统只生成文本提示词
- ⚠️ 如果**配置了**，系统会自动生成图片（2-10分钟）
- 💰 费用参考：15个分镜约 ¥1.2

---

#### 3️⃣ 视频生成API（可选，默认启用）🎬
**作用**：将所有生成的图片合成为一个完整视频

**支持的服务商**：
- ✅ 豆包图生视频（Doubao Video）

**配置内容**：
- API密钥
- Endpoint ID

**说明**：
- ✅ **默认已启用**
- ⚠️ 需要先启用图像生成
- ⚠️ 视频生成需要较长时间（5-30分钟）
- 💰 费用较高，建议先测试图片生成

---

### 第二步：选择分镜数量

选择您需要的分镜数量：
- **9张（3×3）**：快速预览
- **15张（3×5）**：标准分镜
- **20张（4×5）**：详细故事板

---

### 第三步：输入故事内容

1. **输入故事描述**：描述您的故事情节
2. **选择视觉风格**：电影感、动画、写实等
3. **选择输出模式**：
   - 单图模式：生成独立的分镜图片
   - 网格模式：将所有分镜拼接成一张大图
4. **选择比例**：16:9（横屏）或 9:16（竖屏）
5. **点击生成**

---

### 第四步：查看结果

系统会按顺序执行以下操作：

#### 🔹 步骤1：生成分镜描述
- 使用**文本大模型**分析您的故事
- 生成每个分镜的详细描述
- 包括：场景、角色、动作、环境

#### 🔹 步骤2：优化布局
- 智能分配分镜到网格
- 优化视觉流程（Z型、蛇形、螺旋）
- 确保故事节奏流畅

#### 🔹 步骤3：生成AI绘画提示词
- 为每个分镜生成优化的AI绘画提示词
- 包括：视角、光线、色调、氛围
- 适配选定的视觉风格和比例

#### 🔹 步骤4：生成图片（如果启用）
- 使用**文生图模型**逐个生成图片
- 实时显示进度（当前 X/总共 Y）
- 图片自动显示在网格中

#### 🔹 步骤5：合成视频（如果启用）
- 使用**图生视频模型**合成视频
- 每个分镜默认持续3秒
- 支持淡入淡出过渡
- 生成MP4格式视频

---

## 📊 结果展示

### 您将看到：

1. **📝 分镜提示词表格**
   - 每个分镜的详细描述
   - AI绘画提示词
   - 镜头类型和重要程度

2. **🖼️ 分镜图片网格**
   - 所有生成的图片显示在网格中
   - 可以预览每个分镜的视觉效果
   - 支持下载单张或全部图片

3. **🎬 最终视频**
   - 完整的分镜视频
   - 支持在线播放
   - 支持下载

---

## 🎯 三种使用场景

### 场景1：只生成提示词
**配置**：
- ✅ 文本生成API
- ❌ 图像生成API（取消勾选）
- ❌ 视频生成API（取消勾选）

**结果**：
- 📝 分镜脚本
- 📝 AI绘画提示词

**用途**：快速规划，手动选择工具生成图片

---

### 场景2：生成提示词 + 图片（推荐）⭐
**配置**：
- ✅ 文本生成API
- ✅ 图像生成API（保持勾选）
- ❌ 视频生成API（取消勾选）

**结果**：
- 📝 分镜脚本
- 📝 AI绘画提示词
- 🖼️ 分镜图片

**用途**：完整的分镜创作，可视化预览

---

### 场景3：完整工作流（提示词 + 图片 + 视频）🎬
**配置**：
- ✅ 文本生成API
- ✅ 图像生成API（保持勾选）
- ✅ 视频生成API（保持勾选）

**结果**：
- 📝 分镜脚本
- 📝 AI绘画提示词
- 🖼️ 分镜图片
- 🎬 完整视频

**用途**：一键生成完整作品，从故事到视频

---

## 💡 使用建议

### 第一次使用
1. 先测试**场景1**（只生成提示词）
2. 确认提示词质量满意
3. 再启用图像生成
4. 最后启用视频生成

### 成本控制
- 📝 文本生成：每次约 ¥0.1-0.3
- 🖼️ 图像生成：9张约 ¥0.7，15张约 ¥1.2，20张约 ¥1.6
- 🎬 视频生成：根据时长和质量，约 ¥5-20

### 时间预估
- 📝 文本生成：10-30秒
- 🖼️ 图像生成：2-10分钟（取决于分镜数量）
- 🎬 视频生成：5-30分钟（取决于分镜数量和视频长度）

---

## ❓ 常见问题

### Q1: 为什么我只看到文字，没有图片？
**A**: 您可能没有配置图像生成API，或者取消勾选了"图像生成"复选框。
- ✅ 在第一步配置中，勾选"图像生成API"
- ✅ 填写图像API的密钥和Endpoint ID
- ✅ 点击"继续"后开始生成

### Q2: 为什么没有生成视频？
**A**: 有以下几种可能：
- ❌ 没有勾选"视频生成API"复选框
- ❌ 没有配置视频API密钥
- ❌ 图像生成失败（视频需要先有图片）
- ⏱️ 视频生成时间较长，请耐心等待

### Q3: 可以跳过某个步骤吗？
**A**: 可以！
- ✅ 可以只生成提示词（取消勾选图像和视频）
- ✅ 可以生成提示词+图片（只取消勾选视频）
- ✅ 可以启用完整流程（全部勾选）

### Q4: 如何修改配置？
**A**: 刷新页面，重新配置即可。

### Q5: 图片和视频可以下载吗？
**A**: 可以！结果页面提供下载功能。

---

## 🔧 技术细节

### API调用流程
1. **文本生成**：调用 `lib/aiService.ts`
2. **图像生成**：调用 `lib/imageService.ts`
3. **视频生成**：调用 `lib/videoService.ts`

### 数据流转
```
用户输入（故事描述）
    ↓
AI文本模型（生成分镜脚本）
    ↓
提示词生成器（生成绘画提示词）
    ↓
AI图像模型（批量生成图片）
    ↓
AI视频模型（合成视频）
    ↓
结果展示
```

### 错误处理
- ✅ API连接失败：显示错误信息，允许重试
- ✅ 部分图片失败：跳过失败的图片，继续生成
- ✅ 视频生成失败：保留已生成的图片

---

## 🚀 快速开始

### 1. 打开应用
```
http://localhost:3000
```

### 2. 配置API（3个）
- **文本API**：必需
- **图像API**：可选（默认启用）
- **视频API**：可选（默认启用）

### 3. 选择分镜数量
- 9张 / 15张 / 20张

### 4. 输入故事
- 描述故事情节
- 选择视觉风格
- 选择输出模式和比例

### 5. 点击生成
- 等待处理（2-30分钟）
- 查看结果

### 6. 下载作品
- 下载提示词（TXT、Markdown、JSON）
- 下载图片（单张或全部）
- 下载视频（MP4）

---

## 📚 相关文档

- **API配置指南**：`API_KEY_GUIDE.md`
- **API故障排除**：`API_TROUBLESHOOTING.md`
- **玻璃形态设计**：`GLASSMORPHISM_GUIDE.md`
- **快速开始**：`QUICK_START.md`

---

## 🎉 享受创作！

现在您可以使用**完整的AI工作流程**，从故事描述到最终视频，一气呵成！

**任何问题？** 查看相关文档或联系技术支持。

✨ **祝您创作愉快！** ✨


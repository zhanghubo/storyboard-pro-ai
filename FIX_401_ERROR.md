# ⚡ 解决401错误：API密钥格式不正确

## 🎯 您的问题

```
❌ 错误：The API key format is incorrect
❌ 状态码：401 Unauthorized
✅ 好消息：代理工作正常！只是密钥格式不对
```

---

## 🔑 立即解决（3个步骤）

### 步骤1：获取正确的API密钥

#### 🌐 打开火山引擎控制台
https://console.volcengine.com/ark

#### 👤 找到API密钥管理
点击右上角 **用户名** → 选择 **"API访问密钥"** 或 **"密钥管理"**

#### 📋 复制API密钥

**如果已有密钥：**
```
1. 在密钥列表中找到密钥
2. 点击"复制"或"查看"按钮
3. 完整复制密钥（整个字符串）
```

**如果没有密钥：**
```
1. 点击"新建密钥"
2. 输入名称（如：storyboard-app）
3. 点击"确定"
4. ⚠️ 立即复制密钥（只显示这一次！）
5. 保存到安全的地方
```

---

### 步骤2：正确配置密钥

#### ✅ 正确的火山引擎API Key格式：

```
AKLT开头的长字符串，例如：
AKLTxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

或者其他格式，但通常是：
- 40-100个字符
- 纯大小写字母和数字
- 没有空格
- 没有换行
```

#### ❌ 常见错误：

```
❌ sk-xxxxx  ← 这是OpenAI的格式！
❌ AKLT xxx  ← 有空格
❌ AKLT...（不完整）  ← 被截断了
❌ （空白）  ← 忘记填了
```

#### 📝 配置步骤：

1. **打开网页配置页面**
   - 访问 http://localhost:3000
   - 刷新页面（Ctrl+R）

2. **找到"API密钥"输入框**
   - 在"文本生成API"的配置区域

3. **粘贴密钥**
   - Ctrl+V 或 Cmd+V 粘贴
   - **检查！** 确保：
     - ✅ 开头没有多余空格
     - ✅ 结尾没有多余空格
     - ✅ 中间没有换行
     - ✅ 完整的密钥

4. **确认Endpoint ID也正确**
   - 从您的日志看，Endpoint ID是：`doubao-seed-1-6-lite-251015`
   - 这个看起来是对的

---

### 步骤3：重新测试

1. **点击"🔌 测试"按钮**

2. **打开浏览器控制台**（F12）
   - 切换到"Console"标签

3. **查看结果**

#### ✅ 成功的日志：
```javascript
[代理] 转发请求到: https://ark...
[代理] API响应状态: 200  ← 注意这里！
[代理] 请求成功
✓ 连接成功
```

#### ❌ 还是401错误：
```javascript
[代理] API响应状态: 401
[代理] API错误: The API key format is incorrect
```

**如果还是401，检查：**
- [ ] 密钥是从火山引擎控制台复制的
- [ ] 密钥完整，没有截断
- [ ] 密钥没有空格或换行
- [ ] 密钥没有过期或被禁用
- [ ] 账户有余额

---

## 🖼️ 视觉指南

### 火山引擎控制台导航

```
1. 登录 https://console.volcengine.com/ark
   ↓
2. 点击右上角用户名
   ↓
3. 选择"API访问密钥"
   ↓
4. 复制密钥
   ↓
5. 粘贴到网页配置框
   ↓
6. 点击"🔌 测试"
   ↓
7. ✓ 连接成功！
```

### 配置检查清单

```
□ 服务器正在运行（npm run dev）
□ 页面已刷新
□ 从火山引擎控制台获取密钥
□ 密钥完整复制（无空格）
□ Endpoint ID正确
□ 账户有余额
□ 点击测试按钮
```

---

## 🔍 调试技巧

### 查看完整的错误信息

1. **按F12打开开发者工具**

2. **切换到Console标签**

3. **点击"🔌 测试"**

4. **查看红色错误信息**
   - 如果显示 `401` → 密钥问题
   - 如果显示 `404` → Endpoint ID问题
   - 如果显示 `403` → 权限问题
   - 如果显示 `429` → 请求太频繁

### 验证密钥格式

**在浏览器Console中测试：**
```javascript
// 粘贴您的密钥，检查长度和格式
const apiKey = "您的密钥";
console.log("长度:", apiKey.length);  // 应该>20
console.log("开头:", apiKey.substring(0, 4));  // 通常是AKLT
console.log("有空格?", apiKey.includes(" "));  // 应该是false
```

---

## 💡 其他可能的问题

### 问题1：账户余额不足

**检查方法：**
1. 登录火山引擎控制台
2. 查看账户余额
3. 充值（如果需要）

### 问题2：密钥权限不够

**解决方法：**
1. 在控制台查看密钥权限
2. 确保有"模型推理"权限
3. 或创建新的全权限密钥

### 问题3：密钥已过期或禁用

**解决方法：**
1. 检查密钥状态
2. 如果过期，创建新密钥
3. 如果禁用，启用或创建新密钥

### 问题4：账户未实名认证

**解决方法：**
1. 完成实名认证
2. 等待审核通过
3. 再次尝试

---

## 📞 还是不行？试试这个

### 使用curl命令直接测试

在终端运行（替换成您的信息）：

```bash
curl -X POST \
  https://ark.cn-beijing.volces.com/api/v3/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "model": "doubao-seed-1-6-lite-251015",
    "messages": [{"role": "user", "content": "你好"}]
  }'
```

**替换：**
- `YOUR_API_KEY` → 您的实际密钥
- `doubao-seed-1-6-lite-251015` → 您的Endpoint ID

**成功响应：**
```json
{
  "id": "...",
  "choices": [{
    "message": {
      "content": "你好！有什么我可以帮助你的吗？"
    }
  }]
}
```

**如果curl也401：**
- 密钥确实有问题
- 需要重新获取密钥

**如果curl成功，网页还是401：**
- 检查网页中粘贴的密钥
- 可能粘贴时有空格或换行

---

## ✅ 解决后的下一步

当密钥配置正确后：

1. **测试通过** → 🟢 "✓ 连接成功"

2. **开始创作**
   - 选择分镜数量（9/15/20）
   - 输入故事内容
   - 点击生成

3. **查看结果**
   - 分镜描述
   - AI绘画提示词
   - （可选）生成的图片

---

## 🎯 快速总结

**您需要做的：**
1. ✅ 从火山引擎控制台获取正确的API密钥
2. ✅ 完整复制（无空格、无换行）
3. ✅ 粘贴到配置框
4. ✅ 点击测试
5. ✅ 看到绿色"✓ 连接成功"

**问题根源：**
- ❌ 不是代理问题（代理工作正常）
- ❌ 不是Endpoint ID问题（格式正确）
- ✅ **是API密钥格式不正确**

---

**立即获取正确的密钥，再试一次！** 🔑✨

配置正确后，所有功能都会正常工作！

